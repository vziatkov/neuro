# Современные метрики кластеризации для Neuro Project

## Ключевые выводы из современных исследований (2024-2025)

### 1. Для высокоразмерных данных (эмбеддинги)

**Косинусная метрика > Евклидова метрика**

- Особенно для текстов, событий, векторов состояний
- Устойчива к "проклятию размерности"
- Лучшие результаты по метрике silhouette

### 2. Эмбеддинги для семантических данных

**Рекомендуемые модели:**
- **T5-large embeddings** — лучшие результаты в тестах
- **LLaMA-3.1-Embeddings (Meta)** — современный стандарт
- **BERT / Sentence-BERT** — проверенный вариант

### 3. Алгоритмы кластеризации

**k-means → слабоват** (жёстко привязан к евклидовой метрике)

**Лучшие варианты:**
- **HDBSCAN** — лучший выбор (не требует k, устойчив к шуму)
- **DBSCAN** — для плотных структур
- **Spectral Clustering** — для сложных структур на малых наборах

### 4. State-of-the-art комбинация

**Эмбеддинг + Косинус + HDBSCAN** = стандарт для поведенческих моделей

---

## Pipeline для Neuro Project

### Шаг 1: Получаем эмбеддинги

**Входные сущности:**

#### Игровые сущности
- Описание игровой ситуации (state snapshot)
- Действие игрока (action description)
- Результат действия (успех/ошибка/частичный успех)
- Текущие параметры сложности
- Триггеры и события

#### Обучающие сущности
- Математическое задание (текст)
- Способ решения ребёнка
- Ошибки и время реакции
- Прогресс в теме
- Переходы между уровнями

#### Поведенческие сущности
- Последовательность действий
- Частота повторения стратегий
- Признаки стиля игры
- Паттерны ошибок
- Эмоциональный контекст

#### Сценарные сущности (Fantaziya)
- Описание сцены
- Диалоговые реплики
- Ветки сценария
- Ключевые решения
- Философские/эмоциональные мотивы

**Преобразование:**
1. Сущность → текст (JSON → строка, действие → описание)
2. Текст → эмбеддинг (LLaMA/T5/BERT)
3. Получаем вектор 384-1024 размерности

### Шаг 2: Косинусное расстояние

**Формула:**
```
distance = 1 - cosine_similarity(v1, v2)
```

**Преимущества:**
- Не зависит от длины вектора
- Устойчив к высокой размерности
- Лучше работает с эмбеддингами

### Шаг 3: HDBSCAN кластеризация

**Параметры:**
```python
HDBSCAN(
    metric='cosine',
    min_cluster_size=5,
    min_samples=3,
    cluster_selection_epsilon=0.05
)
```

**Результат:**
- Кластеры игровых ситуаций
- Кластеры поведения игрока
- Кластеры знаний ребёнка
- Аномальные паттерны (outliers)

### Шаг 4: Интерпретация кластеров

Для каждого кластера:
1. **Прототип** (centroid → medoid)
2. **ТОП-5 представительных событий**
3. **ТОП-5 пограничных случаев**
4. **Описание поведения** (AI summary)
5. **Уровень сложности** (low/mid/high)
6. **Типичные ошибки**
7. **Рекомендация следующего шага**

### Шаг 5: Применение в проекте

#### В игре / обучающем ассистенте
- Автоматический подбор сложности
- Генерация индивидуальных сценариев
- Подсказки на основе кластера игрока
- Адаптивный сюжет
- Детекция аномалий

#### В Fantaziya
- Организация сцен по смысловым группам
- Генерация переходов между состояниями
- Карта эмоций и решений
- Анализ стиля игрока
- Философские паттерны

---

## Связь с существующими модулями Neuro

### Биометрические данные (`biometricSimulator.ts`)

**Применение:**
- Кластеризация паттернов дыхания/пульса/эмоций
- Выявление типичных биометрических профилей
- Связь эмоциональных состояний с физиологией

### Swarm impulses (`swarmImpulse.ts`)

**Применение:**
- Кластеризация паттернов распространения импульсов
- Группировка эмоциональных траекторий
- Понимание типичных сценариев роя

### Emotional core (`emotional-core.ts`)

**Применение:**
- Кластеризация эмоциональных логов
- Выявление типичных эмоциональных переходов
- Группировка по эмоциональным профилям

### Midstreamer integration

**Связь:**
- **Midstreamer:** детекция аномалий в реальном времени
- **Кластеризация:** понимание долгосрочных паттернов
- **Вместе:** полная картина поведения

### FDA (Functional Data Analysis)

**Связь:**
- FDA анализирует кривые (биометрия, временные сигналы)
- Кластеризация группирует похожие кривые
- FPCA + HDBSCAN = мощный инструмент анализа паттернов

---

## Практические примеры применения

### Пример 1: Адаптивное обучение

**Задача:** Подобрать сложность задания для ребёнка

**Pipeline:**
1. Собираем эмбеддинги всех решённых заданий
2. Кластеризуем по сложности и типу
3. Определяем кластер текущего ребёнка
4. Выбираем следующее задание из соседнего кластера

### Пример 2: Игровая аналитика

**Задача:** Понять типичные паттерны поведения игроков

**Pipeline:**
1. Эмбеддинги игровых сессий
2. Кластеризация по стилю игры
3. Выявление аномалий (tilt, выгорание)
4. Персонализация сложности

### Пример 3: Fantaziya эмоциональные сцены

**Задача:** Группировать сцены по эмоциональному тону

**Pipeline:**
1. Эмбеддинги описаний сцен
2. Кластеризация по эмоциональному профилю
3. Генерация переходов между кластерами
4. Адаптивный сюжет на основе кластера игрока

---

## Технические детали

### Выбор эмбеддингов

**Для текстов:**
- LLaMA-3.1-Embeddings (рекомендуется)
- T5-large
- Sentence-BERT

**Для игровых состояний:**
- Комбинированные эмбеддинги (текст + числовые признаки)
- Custom embeddings на основе игровой логики

### Метрики качества кластеризации

- **Silhouette Score** — общее качество
- **Davies-Bouldin Index** — компактность кластеров
- **Calinski-Harabasz Index** — разделимость

### Обработка outliers

HDBSCAN автоматически выделяет outliers как шум, что идеально для:
- Детекции аномального поведения
- Выявления редких паттернов
- Понимания границ нормального поведения

---

## Следующие шаги

1. **Реализация модуля эмбеддингов** (TypeScript/Node.js)
2. **Интеграция HDBSCAN** (через Python bridge или JS-реализацию)
3. **Визуализация кластеров** (Three.js в Neuro)
4. **Связь с Midstreamer** для гибридного анализа
5. **Применение к биометрическим данным** для кластеризации паттернов

---

## Ссылки на исследования

- [Dimension Insensitive Euclidean Metric (DIEM)](https://arxiv.org/abs/2407.08623)
- [Asymmetric Distance in K-Means](https://www.mdpi.com/2076-3417/15/8/4461)
- [Random Normed k-Means](https://arxiv.org/abs/2504.03928)
- [Comparative Study on Transfer Learning](https://arxiv.org/abs/2111.08658)
- [Curse of Dimensionality](https://agathon.ai/insights/the-curse-of-dimensionality)

