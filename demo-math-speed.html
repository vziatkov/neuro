<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Математика-Реакция</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 40px; }
    .card { max-width: 420px; border: 1px solid #ddd; border-radius: 10px; padding: 20px; }
    h1 { margin: 0 0 10px; }
    .q { font-size: 28px; margin: 20px 0; }
    input { font-size: 20px; padding: 8px 12px; width: 140px; }
    button { font-size: 16px; padding: 8px 14px; margin-left: 8px; }
    .row { display: flex; align-items: center; gap: 8px; margin: 10px 0; }
    .stats { font-size: 14px; color: #555; margin-top: 10px; }
    .ok { color: #0A7F2E; }
    .err { color: #B00020; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Математика-Реакция</h1>
    <div class="q" id="q">Загрузка…</div>
    <div class="row">
      <input id="ans" type="number" inputmode="numeric" />
      <button id="ok">Ответить</button>
    </div>
    <div id="msg"></div>
    <div class="stats">
      <div>Сложность: <span id="level">1</span></div>
      <div>Время (последнее): <span id="last">–</span> сек</div>
      <div>Среднее (по 5): <span id="avg">–</span> сек</div>
      <div>Счёт: <span id="score">0</span></div>
    </div>
  </div>

  <script>
    // Параметры адаптации
    const FAST = 3.0;   // быстрее — повышаем уровень
    const SLOW = 6.0;   // медленнее — понижаем уровень
    const WINDOW = 5;   // размер окна среднего
    let level = 1;      // уровень сложности (1..10)
    let a = 0, b = 0, correct = 0;
    let t0 = 0;
    let lastSec = null;
    let times = [];     // последние WINDOW времен
    let score = 0;

    const $ = (id) => document.getElementById(id);
    const q = $("q"), ans = $("ans"), ok = $("ok"), msg = $("msg");
    const lvl = $("level"), last = $("last"), avg = $("avg"), sc = $("score");

    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function makeQuestion() {
      // Диапазон растёт с уровнем
      const max = 5 + level * 2; // уровень 1 → до 7, уровень 5 → до 15, уровень 10 → до 25
      a = randInt(0, max);
      b = randInt(0, max);
      correct = a + b;
      q.textContent = `${a} + ${b} = ?`;
      ans.value = "";
      ans.focus();
      t0 = performance.now();
    }

    function updateStats() {
      lvl.textContent = String(level);
      last.textContent = lastSec != null ? lastSec.toFixed(2) : "–";
      const m = times.length ? (times.reduce((s, x) => s + x, 0) / times.length) : null;
      avg.textContent = m != null ? m.toFixed(2) : "–";
      sc.textContent = String(score);
    }

    function adaptDifficulty(t) {
      // поддерживаем окно из WINDOW последних времен
      times.push(t);
      if (times.length > WINDOW) times.shift();

      const mean = times.reduce((s, x) => s + x, 0) / times.length;

      if (times.length >= WINDOW) {
        if (mean < FAST && level < 10) level += 1;
        else if (mean > SLOW && level > 1) level -= 1;
      }
    }

    function submit() {
      const t1 = performance.now();
      const tSec = (t1 - t0) / 1000;
      lastSec = tSec;

      const val = Number(ans.value);
      if (val === correct) {
        msg.innerHTML = `<span class="ok">Верно!</span>`;
        score += 1;
        adaptDifficulty(tSec);
      } else {
        msg.innerHTML = `<span class="err">Неверно, правильный ответ: ${correct}</span>`;
        // легкое понижение уровня при ошибке, но не ниже 1
        if (level > 1) level -= 1;
        // сбрасываем окно, чтобы не ломать адаптацию
        times = [];
      }
      updateStats();
      setTimeout(() => { msg.textContent = ""; makeQuestion(); }, 600);
    }

    ok.addEventListener("click", submit);
    ans.addEventListener("keydown", (e) => {
      if (e.key === "Enter") submit();
    });

    // старт
    updateStats();
    makeQuestion();
  </script>
</body>
</html>